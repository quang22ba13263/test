<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Multiplayer Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        #gameContainer {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            border: 1px solid #333;
            background-color: #fff;
            overflow: hidden;
        }
        .player {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transition: all 0.1s ease;
        }
        .localPlayer {
            background-color: #3498db;
        }
        .remotePlayer {
            background-color: #e74c3c;
        }
        #controls {
            margin-top: 20px;
            text-align: center;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            cursor: pointer;
        }
        #status {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Simple Multiplayer Game Demo</h1>
    <div id="gameContainer"></div>
    <div id="controls">
        <button id="up">Up</button><br>
        <button id="left">Left</button>
        <button id="right">Right</button><br>
        <button id="down">Down</button>
    </div>
    <div id="status">Connecting to server...</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Kết nối tới server - tự động kết nối đến URL hiện tại
        const socket = io();
        const statusEl = document.getElementById('status');
        const gameContainer = document.getElementById('gameContainer');
        
        // Thông tin về người chơi
        let playerId = null;
        let players = {};
        
        // Tạo phần tử DOM cho người chơi
        function createPlayerElement(id, isLocal) {
            const playerEl = document.createElement('div');
            playerEl.className = `player ${isLocal ? 'localPlayer' : 'remotePlayer'}`;
            playerEl.id = `player-${id}`;
            gameContainer.appendChild(playerEl);
            return playerEl;
        }
        
        // Cập nhật vị trí người chơi
        function updatePlayerPosition(id, x, y) {
            const playerEl = document.getElementById(`player-${id}`);
            if (playerEl) {
                playerEl.style.left = `${x}px`;
                playerEl.style.top = `${y}px`;
            }
        }
        
        // Xử lý sự kiện kết nối
        socket.on('connect', () => {
            statusEl.textContent = 'Connected to server!';
            
            // Đăng ký người chơi mới
            socket.emit('new_player');
        });
        
        // Nhận ID người chơi từ server
        socket.on('player_id', (data) => {
            playerId = data.id;
            statusEl.textContent = `You are player #${playerId}`;
            
            // Tạo người chơi local
            players[playerId] = {
                x: Math.random() * 570,
                y: Math.random() * 370
            };
            
            createPlayerElement(playerId, true);
            updatePlayerPosition(playerId, players[playerId].x, players[playerId].y);
        });
        
        // Nhận thông tin về tất cả người chơi
        socket.on('players', (serverPlayers) => {
            // Cập nhật thông tin người chơi
            for (const id in serverPlayers) {
                // Bỏ qua chính mình (đã được tạo)
                if (id === playerId) continue;
                
                // Tạo người chơi mới nếu chưa tồn tại
                if (!players[id]) {
                    players[id] = serverPlayers[id];
                    createPlayerElement(id, false);
                }
                
                // Cập nhật vị trí
                players[id] = serverPlayers[id];
                updatePlayerPosition(id, players[id].x, players[id].y);
            }
            
            // Xóa người chơi đã rời đi
            for (const id in players) {
                if (!serverPlayers[id] && id !== playerId) {
                    const playerEl = document.getElementById(`player-${id}`);
                    if (playerEl) {
                        playerEl.remove();
                    }
                    delete players[id];
                }
            }
        });
        
        // Xử lý khi người chơi di chuyển
        socket.on('player_moved', (data) => {
            if (data.id !== playerId) {
                // Cập nhật vị trí người chơi khác
                players[data.id] = {
                    x: data.x,
                    y: data.y
                };
                updatePlayerPosition(data.id, data.x, data.y);
            }
        });
        
        // Xử lý sự kiện ngắt kết nối
        socket.on('disconnect', () => {
            statusEl.textContent = 'Disconnected from server';
        });
        
        // Xử lý điều khiển
        document.getElementById('up').addEventListener('click', () => movePlayer(0, -20));
        document.getElementById('down').addEventListener('click', () => movePlayer(0, 20));
        document.getElementById('left').addEventListener('click', () => movePlayer(-20, 0));
        document.getElementById('right').addEventListener('click', () => movePlayer(20, 0));
        
        // Di chuyển người chơi
        function movePlayer(dx, dy) {
            if (!playerId || !players[playerId]) return;
            
            // Tính toán vị trí mới
            let newX = players[playerId].x + dx;
            let newY = players[playerId].y + dy;
            
            // Giới hạn trong khung game
            newX = Math.max(0, Math.min(570, newX));
            newY = Math.max(0, Math.min(370, newY));
            
            // Cập nhật vị trí
            players[playerId].x = newX;
            players[playerId].y = newY;
            
            // Cập nhật hiển thị
            updatePlayerPosition(playerId, newX, newY);
            
            // Gửi thông tin di chuyển lên server
            socket.emit('move', {
                x: newX,
                y: newY
            });
        }
        
        // Thêm điều khiển bằng bàn phím
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    movePlayer(0, -20);
                    break;
                case 'ArrowDown':
                    movePlayer(0, 20);
                    break;
                case 'ArrowLeft':
                    movePlayer(-20, 0);
                    break;
                case 'ArrowRight':
                    movePlayer(20, 0);
                    break;
            }
        });
    </script>
</body>
</html> 